---
title: "Fisheries model theory: biological model"
author: "Jaideep Joshi, Anna Shchiptsova"
date: "28 March 2022"
output: html_document
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = F, echo = F}
library(rfish)
library(tidyverse)
source("../tests/ref/parameters.cod.R")
source("../tests/ref/simulator.7.R")
```

## Biological model

A fish goes through four life-history processes every year: 

1. Growth - This is the increment in the body size by growth. Growth rates may be different for mature and immature individuals, since mature individuals allocate resources for reproduction.

2. Decision to mature - Every year, fish will decide whether or not to mature (until maturation). Once matured, reproduction begins.

3. Reproduction - production of eggs

4. Mortality - This is natural and fishing-induced death 

Since growth trajectories are dependent on the age of maturation, a fish is best characterized by 
its age $a \in \{1,a_{\max}\}$ and length $l$, where $a_{\max}$ is
the maximum considered age. Below, we present our model formulations for these four life-history processes. For comparison, we also present corresponding formulations from a simpler age-structured model as in Dankel et al. XXXX.

### Growth

Let 
$$
l'_{a} = \left(l_{a - 1}^{\gamma_{1}\gamma_{2}} + \gamma_{1}\alpha_{1}\alpha_{2}^{- \gamma_{1}}\right)^{\frac{1}{{\gamma_{1}\gamma_{2}}}}
$$
Then, the new length of a fish after growth over one year is given by the following
recurrence equation:

$$
l_{a,a_{m}} = \left\{ 
\begin{matrix}          
  l'_{a}, & \mathrm{\text{if juvenile}}, \\   
  \text{max}\{l'_{a} / (1 + \gamma_{1}g)^{\frac{1}{{\gamma_{1}\gamma_{2}}}},\ l_{a-1}\} &  \mathrm{\text{if adult}} \\
\end{matrix} 
\right.\ 
$$                                                                                                                                      
where symbols have the following meanings,

Parameter          Description
------------------ ----------------------------------------------------
$\gamma_{1}$       allometric exponent of relationship between energy-acquisition rate and body weight
$\gamma_{2}$       allometric exponent of length-weight relationship
$\alpha_{1}$       mean weight-specific energy-acquisition rate
$\alpha_{2}$       allometric coefficient of length-weight relationship
$g$                gonadosomatic index (ratio of reproductive investment and somatic weight for mature individuals)

We use the maximum of current and new length for adults to ensure that body size does not shrink.

the effective GSI of the fish during this growth year can be calculated from the langths before and after growth,

$$
g_{a}^{'} = \frac{l_{a - 1}^{\gamma_{1}\gamma_{2}} - l_{a}^{\gamma_{1}\gamma_{2}} + \gamma_{1}\alpha_{1}\alpha_{2}^{- \gamma_{1}}}{\gamma_{1}l_{a}^{\gamma_{1}\gamma_{2}}}.
$$ 


### Decision to mature

The *juvenile* probability to become mature depends on both age $a$ and length $l_a$, and is given by the following
equation:

$$
m_{a} = \frac{1}{1 + e^{- \frac{l_{a} - (s_{m}a + i_{m})}{d_{m}}}},
$$

with the steepness of the curve $d_m$ calculated as

$$
d_{m} = \frac{\Delta l_{p}}{\ln{\left( \frac{1 - p}{p} \right) - \ln\left( \frac{p}{1 - p} \right)}}.
$$


Input parameters for maturation process are listed in the following
table:

Parameter          Description
------------------ ---------------------------------------------------
$\Delta l_{p}$     PMRN width (length range of maturation envelope)
$p$                probability at lower bound of maturation envelope
$s_{m}$            PMRN slope
$i_{m}$            PMRN intercept


### Reproduction

The *adult* fecundity (number of eggs produced) is given by the following equation:

$$
f(a,l_a) = \delta g_{a}^{'} \cdot w(l_a)
$$

where $w(l_a)$ is the weight of the fish of length $l_a$,

$$
w(l_a) =  \alpha_{2}l_{a}^{\gamma_{2}},
$$
where other symbols are as follows,

Parameter            Description
-------------------- ---------------------------------------------------------
$\delta$             mass-specific oocyte density of the mature pre-spawning ovary


### Mortality

The *juvenile* and *adult* instantaneous length dependent natural
mortality rate is given by the following equation:

$$
M(a,l) = \mu_0 + \alpha_{3}\left( \frac{l_{a}}{l_{\text{ref}}} \right)^{\gamma_{3}},
$$

where symbols have the following meanings

Parameter                   Description
--------------------------- --------------------------------------------
$\mu_0$                     Length independent intrinsic mortality rate
$\gamma_{3}$                allometric exponent of relationship between instantaneous natural mortality rate and body length
$\alpha_{3}$                instantaneous natural mortality rate at reference length
$l_{\text{ref}}$            reference length for natural mortality

The *juvenile* and *adult* length dependent survival probability is
thus given by the following equation:

$$
s(a,l) = e^{- (M(a,l) + F)},
$$
where $F$ is the fishing mortality rate.

### Recruitment

Recruitment happens when offspring become juveniles which are old enough to be counted in fisheries surveys. During the offspring stage, individuals experience mortality. The survival of offspring until recruitment is density dependent, such that the number of recruits is the number of eggs times the survival probability of offspring:

$$
n_{recruits} = n_{eggs}\cdot s_0 \cdot \frac{1}{1+\frac{S}{B_{1/2}}},
$$  

where $S$ is the total spawning stock biomass of the population

$$
S = \sum_{\text{mature individuals}} w_a,
$$

and other symbols are as follows.

Parameter                   Description
--------------------------- --------------------------------------------
$s_0$                       Maximum survival probability of offspring, 
$B_{1/2}$                   SSB at which survival probability drops to half 

